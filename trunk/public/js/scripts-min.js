var intervalVotes=false;var venueDivDisplay=null;var usedGeolocation=false;var oldVoteData=null;function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|MIDP|Nokia|J2ME/i.test(navigator.userAgent)}$.extend({keys:function(c){var b=[];$.each(c,function(a){b.push(a)});return b}});function vote_helper(c,a,b){$.ajax({type:"POST",url:"vote.php",data:{action:c,identifier:a,note:b},dataType:"json",success:function(d){if(typeof JSON!="undefined"&&JSON.stringify(oldVoteData)==JSON.stringify(d)){return}if(typeof d.alert!="undefined"){alert(d.alert)}else{if(typeof d.html!="undefined"){$("#dialog_ajax_data").html(d.html);$("#dialog").show();$("#dialog").effect("highlight");if(!intervalVotes){intervalVotes=setInterval(function(){vote_get()},5000)}}else{if(intervalVotes){$("#dialog").hide();clearInterval(intervalVotes);intervalVotes=null}}}oldVoteData=d},error:function(){alert("Fehler beim Setzen des Votes.")}})}function vote_up(a){vote_helper("vote_up",a,null)}function vote_down(a){vote_helper("vote_down",a,null)}function vote_special(a){vote_helper("vote_special",a,null)}function vote_set_note(a){vote_helper("vote_set_note",null,a)}function vote_get(){vote_helper("vote_get",null)}function vote_delete(){vote_helper("vote_delete",null)}function positionHandler(a){lat=a.coords.latitude;lng=a.coords.longitude;$.ajax({type:"POST",url:"locator.php",data:{action:"latlngToAddress",lat:lat,lng:lng},dataType:"json",success:function(b){if(b&&typeof b.address!="undefined"&&b.address){usedGeolocation=true;$("#location").html(b.address);sortVenuesAfterPosition(lat,lng)}},error:function(){sortVenuesAfterPosition(lat,lng)}})}function positionErrorHandler(a){sortVenuesAfterPosition($("#lat").html(),$("#lng").html())}function distanceLatLng(g,m,f,k){g=parseFloat(g);m=parseFloat(m);f=parseFloat(f);k=parseFloat(k);var e=Math.PI/180;g*=e;m*=e;f*=e;k*=e;var d=6372.797;var h=f-g;var i=k-m;var l=Math.sin(h/2)*Math.sin(h/2)+Math.cos(g)*Math.cos(f)*Math.sin(i/2)*Math.sin(i/2);var j=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));var b=d*j;return b}function sortVenuesAfterPosition(d,c){$("#lat").html(d);$("#lng").html(c);var a=new Array();$.each($('[class="venueDiv"]'),function(){var g=$(this).prop("id");var e=$(this).children(".lat").html();var f=$(this).children(".lng").html();a[g]=distanceLatLng(d,c,e,f)});var b=$('[class="venueDiv"]');b.sort(function(g,f){var e=$(g).prop("id");var j=$(f).prop("id");var i=a[e];var h=a[j];if(i>h){return 1}else{if(i<h){return -1}else{return 0}}});$("#venueContainer").html(b);$(document).trigger("locationReady")}function setLocation(a){if(!a){if(isMobileDevice()&&navigator.geolocation){navigator.geolocation.getCurrentPosition(positionHandler,positionErrorHandler,{timeout:5000})}else{sortVenuesAfterPosition($("#lat").html(),$("#lng").html());usedGeolocation=false;$(document).trigger("locationReady")}$.removeCookie("location");return}usedGeolocation=false;$.ajax({type:"POST",url:"locator.php",data:{action:"addressToLatLong",address:a},dataType:"json",success:function(b){if(b&&typeof b.lat!="undefined"&&b.lat&&typeof b.lng!="undefined"&&b.lng){$("#location").html(a);$("#locationInput").val(a);sortVenuesAfterPosition(b.lat,b.lng);$.cookie("location",a,{expires:7})}else{$("#locationInput").val($("#location").html());alert("Keine Geo-Daten zu dieser Adresse gefunden.")}},error:function(){alert("Fehler beim Abrufen der Geo-Position. Bitte Internetverbindung überprüfen.")}})}function setLocationDialog(a){$("#setLocationDialog").dialog({modal:true,title:"Adresse festlegen",buttons:{Ok:function(){var b=$("#locationInput").val();setLocation(b);$("#setLocationDialog").dialog("close");$(this).dialog("close")},Abbrechen:function(){$(this).dialog("close")}}});$(a).tooltip("close")}function setDistance(a){if(typeof a!="undefined"){$("#sliderDistance").slider("option","value",a);$("#distance").val(a);$.cookie("distance",a,{expires:7})}get_venues_distance()}function showLocation(d){var g=$("#lat").html()+","+$("#lng").html();var f="http://maps.googleapis.com/maps/api/staticmap?center="+g+"&zoom=15&language=de&size=400x300&sensor=false&markers=color:red|"+g;var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var c=0;var b="";$.each($('[class="venueDiv"]:visible'),function(){var h=$(this).children(".lat").html();var i=$(this).children(".lng").html();var j=$(this).children('[class="title"]').children("a").html();f+="&markers=color:red|label:"+a[c]+"|"+h+","+i;if(c<5){b+=a[c]+": "+j+"<br />"}c++;if(c>=a.length){c=0}});var e='<img width="400" height="300" src="'+f+'"></img>';e+='<br /><div class="locationMapLegend" style="">'+b+"</div>";alert(e,$("#location").html(),false,425);$(d).tooltip("close")}function get_venues_distance(){var d=$("#lat").html();var b=$("#lng").html();var e=$("#distance").val();var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var c=0;$.each($('[class="venueDiv"]'),function(){var h=$(this).children(".lat").html();var k=$(this).children(".lng").html();var j=$(this);var f="";var i=distanceLatLng(d,b,h,k);var g=Number((i).toFixed(2))*1000;if(i>=1){f="~ "+i.toFixed(1)+" km"}else{f="~ "+g+" m"}if(g>e){$(this).hide()}else{$(this).show()}j.children('[name="distance"]').remove();j.append("<div name='distance'>Distanz: "+f+"</div>")});if($('[class="venueDiv"]:visible').length<1){$("#noVenueFoundNotifier").show()}else{$("#noVenueFoundNotifier").hide()}}function setNoteDialog(){$("#setNoteDialog").dialog({modal:true,title:"Notiz erstellen",buttons:{Ok:function(){var a=$("#noteInput").val();vote_set_note(a);$("#setNoteDialog").dialog("close");$(this).dialog("close")}},width:"400"})}function setVoteSettingsDialog(){$("#setVoteSettingsDialog").dialog({modal:true,title:"Spezial-Votes & Einstellungen",buttons:{"Speichern / Schließen":function(){$.ajax({type:"POST",url:"emails.php",data:{action:"email_set",email:$("#email").val()},dataType:"json",success:function(a){if(typeof a.alert!="undefined"){alert(a.alert)}},error:function(){alert("Fehler beim Setzen der Vote-Einstellungen.")}});$(this).dialog("close")}},width:"425"})}$(document).ready(function(){$.widget("ui.tooltip",$.ui.tooltip,{options:{content:function(){return $(this).prop("title")}}});var a=false;$(document).on("locationReady",function(){a=true;head.ready("cookie",function(){var b=$.cookie("distance");if(typeof b=="undefined"){b=5000}$("#sliderDistance").slider({value:b,min:100,max:10000,step:100,slide:function(c,d){setDistance(d.value)}});$("#socialShare").show();$("#loadingContainer").hide();setDistance(b)});$("a").tooltip();$("span").tooltip();$("div").tooltip();$("input").tooltip()});head.ready("cookie",function(){var b=$.cookie("location");if(typeof b!="undefined"&&b&&b.length){setLocation(b)}else{setLocation(null)}if($("#overlay_info_version").length){var d=$.trim($("#overlay_info_version").html());var c=$.trim($.cookie("overlay_info_version"));if(d!=c){$("#overlay_info").show("slide",{direction:"up"});setTimeout(function(){$.cookie("overlay_info_version",d,{expires:7});$("#overlay_info").hide("slide",{direction:"up"})},10000)}}});setTimeout(function(){if(!a){$(document).trigger("locationReady")}},5000);if($("#show_voting").length){vote_get()}$("#datePicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(2012,10,30),maxDate:"1M",onSelect:function(c,b){document.location=window.location.protocol+"//"+window.location.host+window.location.pathname+"?date="+c}});$("#distance").on("input change",function(){setDistance($(this).val())});$("#dateHeader").click(function(b){$("#dateHeader").tooltip("close");$("#datePicker").datepicker("show");$("#datePicker").datepicker("setDate",$("#date_GET").val())});$("#locationForm").submit(function(c){var b=$("#locationInput").val();setLocation(b);$("#setLocationDialog").dialog("close");c.preventDefault()});$("#noteForm").submit(function(c){var b=$("#noteInput").val();vote_set_note(b);$("#setNoteDialog").dialog("close");c.preventDefault()})});window.alert=function(c,a,d,b){if(typeof a=="undefined"){var a="Hinweis"}if(typeof d=="undefined"||d){c='<table><tr><td><span class="ui-icon ui-icon-alert" style="margin-right: 5px"></span></td><td>'+c+"</td></tr></table>"}if(typeof b=="undefined"){b=300}$(document.createElement("div")).attr({title:a,"class":"alert"}).html(c).dialog({title:a,resizable:false,modal:true,width:b,buttons:{OK:function(){$(this).dialog("close")}}})};